const NEOPAY_STATIC_POPUP="https://raw.githubusercontent.com/neopayvn/neopay-pg-js-sdk/main/dist/neopay-popup.html",VIEW_TYPE={POPUP:"POPUP",REDIRECT:"REDIRECT"};async function hashSHA256(a){let b=new TextEncoder().encode(a),c=await crypto.subtle.digest("SHA-256",b),d=Array.from(new Uint8Array(c)),e=d.map(a=>a.toString(16).padStart(2,"0")).join("");return e.toUpperCase()}function convertUrlToObject(a){try{let b=a.split("?")[1];return JSON.parse('{"'+decodeURI(b.replace(/&/g,'","').replace(/=/g,'":"'))+'"}')}catch(c){return null}}function convertObjectToUrl(a){try{return Object.keys(a).map(b=>`${b}=${a[b]}`).join("&")}catch(b){return""}}let neopaySDK={callbacks:{onSuccess(a){},onFailure(a){},onClose(a){}},configUI:{hiddenFooter:!1,hiddenHeader:!1,hiddenPaymentMethod:!1,hiddenOrderInfo:!1},neo_PaymmentBaseUrl:"https://uat-api.neopay.vn/pg",async init(c,a,d){let b=new XMLHttpRequest;b.onreadystatechange=function(){4==this.readyState&&200==this.status&&$("body").append(this.responseText)},b.open("GET","https://raw.githubusercontent.com/neopayvn/neopay-pg-js-sdk/main/dist/neopay-popup.html",!0),b.send(),console.log("init finished"),neopaySDK.listenEvent(),d&&(neopaySDK.callbacks={...neopaySDK.callbacks,...d}),a&&(neopaySDK.configUI={hiddenHeader:a.neo_HiddenHeader,hiddenFooter:a.neo_HiddenFooter,hiddenPaymentMethod:a.neo_HiddenPaymentMethod,hiddenOrderInfo:a.neo_HiddenOrderInfo}),c&&(neopaySDK.neo_PaymmentBaseUrl=c),neopaySDK.checkUrlPayment()},checkUrlPayment:function(){let b=window.location.href,a=convertUrlToObject(b);a&&(0===Number(a?.neo_ResponseCode?.toString())?neopaySDK.callbacks.onSuccess(a):neopaySDK.callbacks.onFailure(a))},listenEvent:function(){$(document).on("click","#neopay_button_close",function(){$("#neopay").attr("style","display: none; "),neopaySDK.reload(),neopaySDK.callbacks.onClose("close")}),window.addEventListener("message",function(b){let{type:c}=b.data;switch(c){case"NEOPAY_GATEWAY_READY":document.getElementById("neopay_iframe").contentWindow.postMessage({type:"NEOPAY_GATEWAY_CONFIG_UI",configUI:neopaySDK.configUI},"*");break;case"CLOSE_NEOPAY_GATEWAY_POPUP":{let{url:d}=b.data;neopaySDK.close();let a=convertUrlToObject(d);0===Number(a?.neo_ResponseCode?.toString())?neopaySDK.callbacks.onSuccess(a):neopaySDK.callbacks.onFailure(a)}}},!1)},reload:function(){$("#neopay_iframe").removeAttr("src")},async pay(d,e){try{let{neo_ViewType:f,...b}=d,a=convertObjectToUrl(b),g=Object.keys(b).sort((a,b)=>a.localeCompare(b)).map(a=>"neo_PaymentMethod"===a?(b[a]||[]).join(","):b[a]).join("")+e,h=await hashSHA256(g);a=`${neopaySDK.neo_PaymmentBaseUrl}/api/v1/sdk/paygate/neopay?${a}&neo_SecureHash=${h}`;let i=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json","Accept-Language":"vi"}}),j=await i.json(),{neo_ResponseCode:k,neo_ResponseData:c,neo_ResponseMsg:l}=j;0===k?f===VIEW_TYPE.POPUP?($("#neopay_iframe").attr("src",c.redirect),$("#neopay").attr("style","display: block; ")):window.location.href=c.redirect:new Toast({message:l,type:"danger"})}catch(m){new Toast({message:m.message,type:"danger"})}},close:function(){$("#neopay").attr("style","display: none; "),neopaySDK.reload(),neopaySDK.callbacks.onClose("close")}}